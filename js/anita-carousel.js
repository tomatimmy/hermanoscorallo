/**
 * Author: Shadow Themes
 * Author URL: https://shadow-themes.com
 */
"use strict";

class Anita_Carousel{constructor(b,c=!1){if(b instanceof jQuery?this.$el=b:this.$el=jQuery(b),!this.$el.length)return console.warn("Anita Carousel: Element not found"),!1;if(!this.$el.children("div").length)return console.warn("Anita Carousel: There are no slides"),!1;if(this.options={size:.5,spacing:40,responsive:!1,wheelSensitive:50,nav:!0},c)for(let[e,f]of Object.entries(c))this.options[e]=f;let a=this;this.clock=new Anita_Clock,this.prevTime=0,this.$el.css("transform","translateX(0px)"),this.active=0,this.max=this.$el.children().length-1,this.position=0,this.t_position=0;let d=0;this.$el.css("paddingLeft",d+"px").css("paddingRight",d+"px"),this.gallery_pos=new Array,this.gallery=new Array,this.$captions=jQuery('<ul class="anita-carousel-gallery-captions"/>').appendTo(this.$el.parent()),this.captionWidth=this.$captions.children().eq(0).width(),this.$el.children("div").each(function(d){let b=jQuery(this),c="";b.children(".anita-gallery-item__content").length&&(c=b.children(".anita-gallery-item__content").html()),a.$captions.append('<li><div class="anita-gallery-item__content">'+c+"</div></li>")}),this.$el.children("div").eq(this.active).addClass("is-active"),this.$captions.children("li").eq(this.active).addClass("is-active"),this.moveEvent={active:!1,point:0,path:0,current:0,f_Start:function(b){jQuery(b.target).is("a.anita-gallery-nav")?a.moveEvent.active=!1:a.moveEvent.active||(a.moveEvent.active=!0,b.touches?a.moveEvent.point=b.touches[0].clientX:(a.moveEvent.point=b.clientX,a.$el.parent().addClass("is-grabbed")),a.moveEvent.current=a.active)},f_Move:function(b){if(b.preventDefault(),a.moveEvent.active){b.touches?a.moveEvent.path=2*(a.moveEvent.point-b.touches[0].clientX):a.moveEvent.path=2*(a.moveEvent.point-b.clientX);let e=a.position-a.moveEvent.path,c=.5*a.$el.children(".is-active").width();a.moveEvent.path>0&&e<=a.gallery_pos[a.moveEvent.current+1]+c&&(a.moveEvent.current+=1,a.active=a.moveEvent.current,a.changeSlide()),a.moveEvent.path<0&&e>=a.gallery_pos[a.moveEvent.current-1]-c&&(a.moveEvent.current-=1,a.active=a.moveEvent.current,a.changeSlide());let d=.5*a.captionWidth*a.moveEvent.path/(c+a.options.spacing);if(a.position-=a.moveEvent.path,a.t_position-=d,a.position>a.gallery_pos[0]||a.position<a.gallery_pos[a.max]){if(a.position>a.gallery_pos[0]&&a.moveEvent.path<0){let f=(a.position-a.gallery_pos[0])/(.25*window.innerWidth);a.position+=a.moveEvent.path*f,a.t_position+=d*f}if(a.position<a.gallery_pos[a.max]&&a.moveEvent.path>0){let g=(a.gallery_pos[a.max]-a.position)/(.25*window.innerWidth);a.position+=a.moveEvent.path*g,a.t_position+=d*g}}a.$el.css("transform","translateX("+a.position+"px)"),a.$captions.css("transform","translateX("+a.t_position+"px)"),b.touches?a.moveEvent.point=b.touches[0].clientX:a.moveEvent.point=b.clientX}},f_End:function(){a.changeSlide(),a.moveEvent.active=!1,a.moveEvent.point=0,a.moveEvent.path=0,a.$el.parent().removeClass("is-grabbed")}},jQuery(window).on("resize",function(){a.layout(),setTimeout(function(){a.layout()},300,a)}).on("load",function(){a.layout()}),this.$el.parent().on("mousedown",function(b){a.moveEvent.f_Start(b)}),this.$el.parent().on("mousemove",function(b){a.moveEvent.f_Move(b)}),this.$el.parent().on("mouseup",function(b){a.moveEvent.f_End()}),this.$el.parent().on("mouseleave",function(b){a.moveEvent.f_End()}),this.wheelTime=0,this.$el.parent()[0].addEventListener("wheel",function(b){b.timeStamp-a.wheelTime>a.options.wheelSensitive?(b.deltaX>0&&a.prevSlide(),b.deltaX<0&&a.nextSlide(),b.deltaY>0&&a.nextSlide(),b.deltaY<0&&a.prevSlide()):b.preventDefault(),a.wheelTime=b.timeStamp}),this.$captions.on("mouseenter","a",function(){a.$el.children(".is-active").addClass("is-zoomed"),a.$el.addClass("has-zoomed")}).on("mouseleave","a",function(){a.$el.children().removeClass("is-zoomed"),a.$el.removeClass("has-zoomed")}),this.$el.parent().on("touchstart",function(b){a.moveEvent.f_Start(b)}),this.$el.parent().on("touchmove",function(b){a.moveEvent.f_Move(b)}),this.$el.parent().on("touchend",function(){a.moveEvent.f_End()}),jQuery(document).on("keyup",function(b){37==b.keyCode&&a.prevSlide(),39==b.keyCode&&a.nextSlide()}),this.options.nav&&(this.ui={prev:jQuery('<a href="javascript:void(0)" class="anita-gallery-nav anita-gallery-nav__prev">'+(a.$el.attr("data-prev-label")?"<span>"+a.$el.attr("data-prev-label")+"</span>":"")+"</a>"),next:jQuery('<a href="javascript:void(0)" class="anita-gallery-nav anita-gallery-nav__next">'+(a.$el.attr("data-next-label")?"<span>"+a.$el.attr("data-next-label")+"</span>":"")+"</a>")},this.$el.after(this.ui.next).after(this.ui.prev),this.ui.prev.on("click",function(){a.prevSlide()}),this.ui.next.on("click",function(){a.nextSlide()})),a.layout(),this.$captions.on("click",".anita-album-link",function(){window.localStorage.setItem("anita_listing_index",a.active)}),this.$el.hasClass("anita-albums-listing")&&null!==window.localStorage.getItem("anita_back_from_album")&&null!==window.localStorage.getItem("anita_listing_index")&&(!0==JSON.parse(window.localStorage.getItem("anita_back_from_album"))&&(this.active=parseInt(JSON.parse(window.localStorage.getItem("anita_listing_index")),10),this.position=this.gallery_pos[this.active],this.t_position=-1*this.active*this.captionWidth,this.$el.css("transform","translateX("+this.position+"px)"),this.$captions.css("transform","translateX("+this.t_position+"px)")),window.localStorage.setItem("anita_back_from_album",!1),window.localStorage.setItem("anita_listing_index","0")),this.changeSlide(),this.anim=requestAnimationFrame(()=>this.animate())}prevSlide(){this.active-=1,this.active<0&&(this.active=0),this.changeSlide()}nextSlide(){this.active+=1,this.active>this.max&&(this.active=this.max),this.changeSlide()}changeSlide(){this.$el.children(".is-active").children("video").length&&this.$el.children(".is-active").children("video")[0].pause(),this.$el.children(".is-active").removeClass("is-active"),this.$captions.children(".is-active").removeClass("is-active"),this.$el.children("div").eq(this.active).addClass("is-active"),this.$captions.children("li").eq(this.active).addClass("is-active"),this.options.nav&&(0==this.active?this.ui.prev.addClass("is-disabled"):this.ui.prev.removeClass("is-disabled"),this.active==this.max?this.ui.next.addClass("is-disabled"):this.ui.next.removeClass("is-disabled")),this.$el.children(".is-active").children("video").length&&this.$el.children(".is-active").children("video")[0].play()}layout(){let a=this,b=0;this.captionWidth=this.$captions.children().eq(0).width(),this.$el.children("div").each(function(e){let c=jQuery(this),d=0;if(c.find("img").length)c.find("img").height(window.innerHeight*a.options.size),d=c.width();else{if(!c.children("video").length)return!1;c.children("video").height(window.innerHeight*a.options.size),d=c.width()}c.css("marginLeft",.5*a.options.spacing+"px").css("marginRight",.5*a.options.spacing+"px"),a.gallery_pos[e]=-1*(b-(window.innerWidth-d-a.options.spacing)*.5),b+=d+a.options.spacing}),this.changeSlide()}animate(){this.anim=requestAnimationFrame(()=>this.animate());let a=this.clock.getElapsedTime(),b=a-this.prevTime;this.prevTime=a,this.moveEvent.active||(this.position+=(this.gallery_pos[this.active]-this.position)*3*b,this.t_position+=(-1*this.active*this.captionWidth-this.t_position)*3*b,this.$el.css("transform","translateX("+this.position+"px)"),this.$captions.css("transform","translateX("+this.t_position+"px)"))}}